{"version":3,"file":"web-mito-sdk.umd.js","sources":["../src/index.js","../src/module/watchApiErrorXhr.js","../src/module/watchJsError.js","../src/module/watchApiErrorFetch.js","../src/module/watchResourceError.js"],"sourcesContent":["import { watchApiErrorXhr } from \"./module/watchApiErrorXhr.js\";\nimport { watchApiErrorFetch } from \"./module/watchApiErrorFetch.js\";\nimport { watchJsError } from \"./module/watchJsError.js\";\nimport { watchResourceError } from \"./module/watchResourceError.js\";\n\nexport class webMitoSdkInit {\n  constructor({ name, type, config, sendApi, sendResource, sendJsError }) {\n    this.name = name;\n    this.type = type;\n    this.config = config;\n    this.sendApi = sendApi;\n    this.sendJsError = sendJsError;\n    this.sendResource = sendResource;\n  }\n  init() {\n    this.sendApi && watchApiErrorXhr(this.name);\n    this.sendApi && watchApiErrorFetch(this.name);\n    this.sendJsError && watchJsError(this.name, this.type, this.config);\n    this.sendResource && watchResourceError(this.name);\n  }\n}\n","export function watchApiErrorXhr(name) {\n  function hijackXHR() {\n   \n    const proto = window.XMLHttpRequest.prototype;\n    const originalOpen = proto.open;\n    const originalSend = proto.send;\n    var _handleEvent = function (event) {\n      if (event && event.currentTarget && event.currentTarget.status !== 200) {\n        console.log(event.currentTarget, \"apiError\");\n        // 自定义错误上报 }\n      }\n    };\n    // proto.open = function (method, url, async) {\n    //   this._ctx = {\n    //     url: url || \"\",\n    //     method,\n    //   };\n    //   return originalOpen.apply(this, arguments);\n    // };\n    proto.send = function () {\n      if (this[\"addEventListener\"]) {\n        this[\"addEventListener\"](\"error\", _handleEvent);\n        this[\"addEventListener\"](\"load\", _handleEvent);\n        this[\"addEventListener\"](\"abort\", _handleEvent);\n      } else {\n        var _oldStateChange = this[\"onreadystatechange\"];\n        this[\"onreadystatechange\"] = function (event) {\n          if (this.readyState === 4) {\n            _handleEvent(event);\n          }\n          _oldStateChange && _oldStateChange.apply(this, arguments);\n        };\n      }\n      return originalSend.apply(this, arguments);\n    };\n\n\n  }\n  window.XMLHttpRequest && hijackXHR();\n}\n","export function watchJsError(name, type, config) {\n  window.addEventListener(\n    \"error\",\n    (event) => {\n      if (!event.target.localName) {\n        console.log(\"这是代码错误\", event);\n      }\n    },\n    true\n  );\n\n  window.addEventListener(\"unhandledrejection\", (event) => {\n    console.log(\"这是Promise场景中错误\", event);\n  });\n\n  if (type == \"VUE\") {\n    config.errorHandler = function (err, vm, info) {\n      console.log(`Error: ${err.toString()}\\nInfo: ${info}`, \"vue内部错误\");\n    };\n  }\n}\n","export function watchApiErrorFetch(name) {\n  if (!window.fetch) return;\n  let _oldFetch = window.fetch;\n  window.fetch = function () {\n    return _oldFetch\n      .apply(this, arguments)\n      .then((res) => {\n        if (!res.ok) {\n          // True if status is HTTP 2xx\n          // 上报错误\n        }\n        return res;\n      })\n      .catch((error) => {\n        // 上报错误\n        throw error;\n      });\n  };\n}\n","export function watchResourceError(name) {\n  window.addEventListener(\n    \"error\",\n    (event) => {\n      if (event.target.localName) {\n        console.log(\"这是资源错误\", event);\n      }\n    },\n    true\n  );\n}\n"],"names":["webMitoSdkInit","name","type","config","_ref","sendApi","sendResource","sendJsError","this","prototype","init","originalSend","_handleEvent","window","XMLHttpRequest","proto","send","event","currentTarget","status","console","log","readyState","_oldStateChange","apply","arguments","watchApiErrorFetch","fetch","_oldFetch","then","res","error","addEventListener","target","localName","errorHandler","err","vm","info","toString"],"mappings":"oOAKaA,IAAcA,eAAA,WACzB,cAAcC,IAAMC,EAAAA,EAAAA,KAAMC,EAAMC,EAAND,OAAQE,EAAOD,EAAPC,QAASC,EAAAA,EAAAA,aAAcC,EAAAA,EAAAA,YACvDC,KAAKP,KADOA,EAAAA,KAEZO,KAAKN,KAAOA,EACZM,KAAKL,OAASA,EACdK,KAAKH,QAAUA,EACfG,KAAKD,YAAcA,EACnBC,KAAKF,aAAeA,CACtB,CAMC,OANAN,EAAAS,UACDC,KAAA,iBCTQC,EACUC,ECNeV,EAAMC,EFerCK,KAAKH,SCuBPQ,OAAOC,mBAnCSD,OAAOC,eAAeL,UAE9BE,EAAeI,EAAMC,KACXJ,EAAG,SAAUK,GACvBA,GAASA,EAAMC,eAAgD,MAA/BD,EAAMC,cAAcC,QACtDC,QAAQC,IAAIJ,EAAMC,cAAe,WAGrC,EAQAH,EAAMC,KAAO,WACX,GAAIR,KAAuB,iBACzBA,KAAuB,iBAAE,QAASI,GAClCJ,KAAuB,iBAAE,OAAQI,GACjCJ,KAAuB,iBAAE,QAASI,OAC7B,CACL,MAAsBJ,KAAyB,mBAC/CA,KAAyB,mBAAI,SAAUS,GACb,IAApBT,KAAKc,YACPV,EAAaK,GAEfM,GAAmBA,EAAgBC,MAAMhB,KAAMiB,UACjD,CACF,CACA,OAAmBd,EAACa,MAAMhB,KAAMiB,UAClC,GDlBAjB,KAAKH,SGhBOqB,SAAmBzB,GACjC,GAAKY,OAAOc,MAAZ,CACA,IAAIC,EAAYf,OAAOc,MACvBd,OAAOc,MAAQ,WACb,OAAgBC,EACbJ,MAAMhB,KAAMiB,WACZI,KAAK,SAACC,GAKL,OACFA,CAAA,GAAE,MACK,SAACC,GAEN,MACFA,CAAA,EACJ,CAfA,CAgBF,CHFoBL,GAChBlB,KAAKD,cEjB0BL,EFiBaM,KAAKN,KEjBZC,EFiBkBK,KAAKL,OEhB9DU,OAAOmB,iBACL,QACA,SAACf,GACMA,EAAMgB,OAAOC,WAChBd,QAAQC,IAAI,SAAUJ,EAE1B,GACA,GAGFJ,OAAOmB,iBAAiB,qBAAsB,SAACf,GAC7CG,QAAQC,IAAI,iBAAkBJ,EAChC,GAEY,OAARf,IACFC,EAAOgC,aAAe,SAAUC,EAAKC,EAAIC,GACvClB,QAAQC,cAAce,EAAIG,WAAU,WAAWD,EAAQ,UACzD,IFAA9B,KAAKF,cIjBPO,OAAOmB,iBACL,QACA,SAACf,GACKA,EAAMgB,OAAOC,WACfd,QAAQC,IAAI,SAAUJ,EAE1B,GACA,EJWF,EAACjB,CAAA,CAdwB"}